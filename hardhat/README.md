# zkJoe circom circuits

The `circuits` folder contains the `withdraw.circom` and `merkleTree.circom` [circuit](https://github.com/tornadocash/tornado-core) used in the zkJoe application.

# zkJoe smart contracts

The `contracts` folder contains the following smart contracts:
- `MockOracle`: to mock the price feed oracle for testing.
- `Joetroller`: to regulate the amount of collateral a user has to maintain
- `MajorInterestRateModel`, `StableInterestRateModel`, `GovernanceInterestRateModel`: to control the interest rate model
- `Hasher`: to hash node values in merkle tree (this contract was generated by circomlib)
- `MerkleTreeWithHistory`: to keep track of merkle tree for money markets of different tokens
- `Verifier`: to verify the zk proof (this contract was generated using snarkjs).
- `JWrappedNative`, `JCollateralCapErc20`: inherited `JToken` contracts and wrapped underlying ERC20 tokens to accrue interest
- `JWrappedNativeDelegator`: delegator for `JWrappedNative` contract
- `JCollateralCapErc20Delegator`:  delegator for `JCollateralCapErc20` contract

## Install dependencies

To install all the dependencies run:

```bash
npm run install
```

## Compile circuits and generate and verify the zk-proof using [snarkjs](https://github.com/iden3/snarkjs)

To know how is everything generated, you can see the `compile-circuits.sh` file inside the `scipts` folder.

To compile and run the circuit, go inside the sudoku folder and run:

Run the first time:

```bash
chmod u+x compile-circuits.sh
```

And after that, you can always run:

```bash
./compile-circuits.sh
```

## Deploy on [Harmony Testnet](https://explorer.pops.one/)

Create a `.env` file and add to it:

```text
DEPLOYER_PRIVATE_KEY=<deployerPrivateKey>
```

where `deployerPrivateKey` is the private key of your wallet.

To deploy on Harmony Testnet run:

```bash
npx hardhat deploy --network harmony-devnet
```

## Deploy on [Harmony Mainnet](https://explorer.harmony.one/)

Create a `.env` file and add to it:

```text
DEPLOYER_PRIVATE_KEY=<deployerPrivateKey>
```

where `deployerPrivateKey` is the private key of your wallet.

To deploy on Harmony Mainnet run:

```bash
npx hardhat deploy --network harmony-mainnet
```
